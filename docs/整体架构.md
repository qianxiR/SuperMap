# SuperMap 智能地理信息分析系统 - 整体架构

## 系统架构图

```mermaid
graph TB
    subgraph "前端应用层 (Vue 3 + TypeScript)"
        A1[地图渲染层<br/>OpenLayers 10.6.1]
        A2[UI组件层<br/>29个组件 + Ant Design Vue]
        A3[状态管理层<br/>17个Pinia Store模块]
        A4[业务逻辑层<br/>17个Composable函数]
        A5[双模式界面<br/>LLM智能模式 + 传统GIS模式]
    end
    
    subgraph "后端服务层 (微服务架构)"
        B1[用户认证服务<br/>FastAPI + PostgreSQL<br/>端口: 8088]
        B2[空间分析服务<br/>Node.js + Express + DDD<br/>端口: 8087]
        B3[API网关层<br/>统一接口管理]
    end
    
    subgraph "数据存储层"
        C1[PostgreSQL 15<br/>用户数据 + 权限管理]
        C2[本地存储<br/>状态持久化 + 缓存]
    end
    
    subgraph "外部服务层"
        D1[SuperMap iServer<br/>地图瓦片服务]
        D2[SuperMap iServer<br/>矢量数据服务]
        D3[AI服务接口<br/>智能助手 (待集成)]
    end
    
    subgraph "空间分析引擎"
        E1[Turf.js 7.2.0<br/>前端空间计算]
        E2[Turf.js<br/>后端空间分析]
        E3[SuperMap SDK<br/>高级空间分析]
    end
    
    %% 前端内部连接
    A1 --> A3
    A2 --> A3
    A3 --> A4
    A4 --> A5
    
    %% 前后端连接
    A4 --> B1
    A4 --> B2
    A1 --> D1
    A1 --> D2
    A5 --> D3
    
    %% 后端内部连接
    B1 --> C1
    B2 --> E2
    B3 --> B1
    B3 --> B2
    
    %% 空间分析连接
    A4 --> E1
    A1 --> E3
    
    %% 数据持久化
    A3 --> C2
    
    classDef frontend fill:#e1f5fe
    classDef backend fill:#f3e5f5
    classDef storage fill:#e8f5e8
    classDef external fill:#fff3e0
    classDef analysis fill:#fce4ec
    
    class A1,A2,A3,A4,A5 frontend
    class B1,B2,B3 backend
    class C1,C2 storage
    class D1,D2,D3 external
    class E1,E2,E3 analysis
```

## 技术架构详情

### 前端架构 (Vue 3 生态)
- **框架**: Vue 3.5.18 + TypeScript 5.9.2
- **地图引擎**: OpenLayers 10.6.1
- **状态管理**: Pinia 3.0.3 (17个模块化Store)
- **UI框架**: Ant Design Vue 4.2.6
- **构建工具**: Vite 7.0.6
- **空间分析**: Turf.js 7.2.0

### 后端架构 (微服务)
- **用户服务**: FastAPI 0.104 + PostgreSQL 15 (端口: 8088)
- **分析服务**: Node.js 18+ + Express + DDD架构 (端口: 8087)
- **API文档**: Swagger UI自动生成
- **数据验证**: Pydantic + Joi
- **统一响应格式**: 所有分析API使用统一的toApiResponse()方法

### 部署架构
```
开发环境:
├── 前端服务: localhost:5173 (Vite Dev Server)
├── 用户服务: localhost:8088 (FastAPI + Uvicorn)
├── 分析服务: localhost:8087 (Node.js + Express)
└── 数据库: localhost:5432 (PostgreSQL)

生产环境:
├── 前端: 静态文件部署 (Nginx)
├── 后端: 容器化部署 (Docker)
└── 数据库: 集群部署
```

## 核心功能模块

### 1. 用户管理模块 ✅ 100%完成
- 用户注册/登录/认证
- JWT令牌管理
- 用户资料管理
- 权限控制

### 2. 地图基础功能 ✅ 100%完成
- SuperMap iServer集成
- 多底图支持 + 主题切换
- 实时坐标显示
- 图层管理 + 样式控制

### 3. 空间分析功能 ✅ 100%完成
- 缓冲区分析
- 相交分析  
- 擦除分析
- 最短路径分析

### 4. 测量工具 ✅ 100%完成
- 距离测量
- 面积测量
- 实时计算显示

### 5. LLM智能模式 🔄 70%完成
- 聊天界面 ✅
- 对话历史 ✅  
- AI助手集成 🔄 (待开发)
- 自然语言地图操作 🔄 (待开发)

## 数据流转架构

### 空间分析数据流
```
前端OpenLayers要素 
→ GeoJSON格式转换 
→ HTTP API调用 (端口: 8087)
→ 后端Turf.js处理 
→ 统一API响应格式 (features字段)
→ 前端地图显示
```

### 用户认证流程
```
用户登录 
→ FastAPI验证 
→ JWT令牌生成 
→ 前端存储 
→ 后续请求携带令牌 
→ 中间件验证
```