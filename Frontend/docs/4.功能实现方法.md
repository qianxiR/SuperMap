# åŠŸèƒ½å®ç°æ–¹æ³•

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### **ç»„åˆå¼å‡½æ•°å±‚çº§ç»“æ„**
```
åº”ç”¨æ ¹ç»„ä»¶ (App.vue)
    â†“
é¡µé¢çº§ç»„ä»¶ (Dashboard.vue)
    â†“
ä»ªè¡¨æ¿å¸ƒå±€ (DashboardLayout.vue)
    â†“
åŠŸèƒ½åŒºåŸŸç»„ä»¶
    â”œâ”€â”€ åœ°å›¾åŒºåŸŸ (SuperMapViewer.vue) â†’ useMap()
    â”œâ”€â”€ å›¾å±‚ç®¡ç† (LayerManager.vue) â†’ useLayerManager()
    â”œâ”€â”€ è¦ç´ é€‰æ‹© (FeatureSelection.vue) â†’ useFeatureSelection()
    â”œâ”€â”€ è¦ç´ æŸ¥è¯¢ (FeatureQueryPanel.vue) â†’ useFeatureQuery()
    â””â”€â”€ åˆ†æå·¥å…·é¢æ¿
        â”œâ”€â”€ ç¼“å†²åŒºåˆ†æ (BufferAnalysisPanel.vue) â†’ useBufferAnalysis()
        â”œâ”€â”€ å åŠ åˆ†æ (OverlayAnalysisPanel.vue) â†’ useOverlayAnalysis()
        â”œâ”€â”€ æœ€çŸ­è·¯å¾„åˆ†æ (ShortestPathAnalysisPanel.vue) â†’ useShortestPathAnalysis()
        
```

## ğŸ—ºï¸ åœ°å›¾æ ¸å¿ƒåŠŸèƒ½ (useMap)

### **åŠŸèƒ½æè¿°**
åœ°å›¾æ˜¾ç¤ºã€äº¤äº’ã€æ ·å¼ç®¡ç†çš„æ ¸å¿ƒç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `createLayerStyle()` - åˆ›å»ºå›¾å±‚æ ·å¼
- `updateLayerStyles()` - æ›´æ–°å›¾å±‚æ ·å¼
- `createMap()` - åˆ›å»ºåœ°å›¾å®ä¾‹
- `addLayer()` - æ·»åŠ å›¾å±‚
- `removeLayer()` - ç§»é™¤å›¾å±‚
- `setMapView()` - è®¾ç½®åœ°å›¾è§†å›¾
- `handleMapClick()` - å¤„ç†åœ°å›¾ç‚¹å‡»
- `handleMapHover()` - å¤„ç†åœ°å›¾æ‚¬åœ
- `handleMapSelect()` - å¤„ç†åœ°å›¾é€‰æ‹©

### **å­˜å‚¨çš„çŠ¶æ€**
- `mapContainer` - åœ°å›¾å®¹å™¨å¼•ç”¨
- `hoverTimer` - æ‚¬åœå®šæ—¶å™¨
- `selectSourceRef` - é€‰æ‹©å›¾å±‚æºå¼•ç”¨
- `disposers` - æ¸…ç†å‡½æ•°æ•°ç»„

### **ä¾èµ–çš„Store**
- `useMapStore` - åœ°å›¾çŠ¶æ€ç®¡ç†
- `useSelectionStore` - é€‰æ‹©çŠ¶æ€ç®¡ç†
- `usePopupStore` - å¼¹çª—çŠ¶æ€ç®¡ç†
- `useAnalysisStore` - åˆ†æçŠ¶æ€ç®¡ç†
- `useLoadingStore` - åŠ è½½çŠ¶æ€ç®¡ç†
- `useThemeStore` - ä¸»é¢˜çŠ¶æ€ç®¡ç†

## ğŸ›ï¸ å›¾å±‚ç®¡ç†åŠŸèƒ½ (useLayerManager)

### **åŠŸèƒ½æè¿°**
å›¾å±‚æ˜¾ç¤ºæ§åˆ¶ã€æ ·å¼ç®¡ç†ã€è¦ç´ æ“ä½œçš„ç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `clearLayerSelection()` - æ¸…é™¤å›¾å±‚é€‰æ‹©é«˜äº®
- `toggleLayerVisibility()` - åˆ‡æ¢å›¾å±‚å¯è§æ€§
- `updateLayerOpacity()` - æ›´æ–°å›¾å±‚é€æ˜åº¦
- `saveFeaturesAsLayer()` - ä¿å­˜è¦ç´ ä¸ºæ–°å›¾å±‚
- `exportLayerData()` - å¯¼å‡ºå›¾å±‚æ•°æ®
- `importLayerData()` - å¯¼å…¥å›¾å±‚æ•°æ®

### **å­˜å‚¨çš„çŠ¶æ€**
- `confirmDialogVisible` - ç¡®è®¤å¯¹è¯æ¡†å¯è§æ€§
- `confirmDialogConfig` - ç¡®è®¤å¯¹è¯æ¡†é…ç½®

### **ä¾èµ–çš„Store**
- `useMapStore` - åœ°å›¾çŠ¶æ€ç®¡ç†
- `useSelectionStore` - é€‰æ‹©çŠ¶æ€ç®¡ç†
- `usePopupStore` - å¼¹çª—çŠ¶æ€ç®¡ç†
- `useAnalysisStore` - åˆ†æçŠ¶æ€ç®¡ç†

## ğŸ¯ è¦ç´ é€‰æ‹©åŠŸèƒ½ (useFeatureSelection)

### **åŠŸèƒ½æè¿°**
è¦ç´ é€‰æ‹©ã€é«˜äº®ã€å‡ ä½•è®¡ç®—çš„ç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `calculateLineLength()` - è®¡ç®—çº¿é•¿åº¦
- `calculatePolygonArea()` - è®¡ç®—å¤šè¾¹å½¢é¢ç§¯
- `haversineDistance()` - è®¡ç®—çƒé¢è·ç¦»
- `getFeatureType()` - è·å–è¦ç´ ç±»å‹
- `getFeatureCoords()` - è·å–è¦ç´ åæ ‡
- `getFeatureGeometryInfo()` - è·å–è¦ç´ å‡ ä½•ä¿¡æ¯
- `createBoxSelectInteraction()` - åˆ›å»ºæ¡†é€‰äº¤äº’
- `handleFeatureSelection()` - å¤„ç†è¦ç´ é€‰æ‹©

### **å­˜å‚¨çš„çŠ¶æ€**
- `boxSelectInteraction` - æ¡†é€‰äº¤äº’å¼•ç”¨
- `highlightedFeature` - é«˜äº®è¦ç´ å¼•ç”¨
- `selectedFeatures` - é€‰ä¸­è¦ç´ åˆ—è¡¨ï¼ˆcomputedï¼‰
- `selectedFeatureIndex` - é€‰ä¸­è¦ç´ ç´¢å¼•ï¼ˆcomputedï¼‰

### **ä¾èµ–çš„Store**
- `useMapStore` - åœ°å›¾çŠ¶æ€ç®¡ç†
- `useAnalysisStore` - åˆ†æçŠ¶æ€ç®¡ç†
- `useAreaSelectionStore` - åŒºåŸŸé€‰æ‹©çŠ¶æ€ç®¡ç†
- `usePopupStore` - å¼¹çª—çŠ¶æ€ç®¡ç†

## ğŸ” è¦ç´ æŸ¥è¯¢åŠŸèƒ½ (useFeatureQuery)

### **åŠŸèƒ½æè¿°**
è¦ç´ æŸ¥è¯¢ã€é«˜äº®ã€ç»“æœç®¡ç†çš„ç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `executeQuery()` - æ‰§è¡ŒæŸ¥è¯¢
- `getLayerFields()` - è·å–å›¾å±‚å­—æ®µ
- `highlightQueryResults()` - é«˜äº®æŸ¥è¯¢ç»“æœ
- `handleSelectFeature()` - å¤„ç†è¦ç´ é€‰æ‹©
- `highlightFeatureOnMap()` - åœ¨åœ°å›¾ä¸Šé«˜äº®è¦ç´ 
- `triggerMapFeatureHighlight()` - è§¦å‘åœ°å›¾è¦ç´ é«˜äº®
- `removeHighlightFeature()` - ç§»é™¤è¦ç´ é«˜äº®
- `isSameFeature()` - åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€è¦ç´ 

### **å­˜å‚¨çš„çŠ¶æ€**
- `selectedLayerId` - é€‰ä¸­çš„å›¾å±‚IDï¼ˆcomputedï¼‰
- `queryResults` - æŸ¥è¯¢ç»“æœï¼ˆcomputedï¼‰
- `layerFields` - å›¾å±‚å­—æ®µï¼ˆcomputedï¼‰
- `queryConfig` - æŸ¥è¯¢é…ç½®ï¼ˆcomputedï¼‰
- `isQuerying` - æ˜¯å¦æ­£åœ¨æŸ¥è¯¢ï¼ˆcomputedï¼‰
- `lastExecutedQuery` - æœ€åæ‰§è¡Œçš„æŸ¥è¯¢ï¼ˆcomputedï¼‰
- `selectedFeatureIndex` - é€‰ä¸­çš„è¦ç´ ç´¢å¼•ï¼ˆcomputedï¼‰
- `highlightedFeature` - é«˜äº®çš„è¦ç´ ï¼ˆcomputedï¼‰

### **ä¾èµ–çš„Store**
- `useFeatureQueryStore` - è¦ç´ æŸ¥è¯¢çŠ¶æ€ç®¡ç†

## ğŸ“Š ç¼“å†²åŒºåˆ†æåŠŸèƒ½ (useBufferAnalysis)

### **åŠŸèƒ½æè¿°**
ç¼“å†²åŒºåˆ†æã€å‚æ•°è®¾ç½®ã€ç»“æœç®¡ç†çš„ç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `saveState()` - ä¿å­˜åˆ†æçŠ¶æ€
- `restoreState()` - æ¢å¤åˆ†æçŠ¶æ€
- `clearState()` - æ¸…ç†åˆ†æçŠ¶æ€
- `executeBufferAnalysis()` - æ‰§è¡Œç¼“å†²åŒºåˆ†æ
- `removeBufferLayers()` - ç§»é™¤ç¼“å†²åŒºå›¾å±‚
- `exportBufferResults()` - å¯¼å‡ºç¼“å†²åŒºç»“æœ

### **å­˜å‚¨çš„çŠ¶æ€**
- `selectedAnalysisLayerId` - é€‰ä¸­çš„åˆ†æå›¾å±‚ID
- `bufferSettings` - ç¼“å†²åŒºè®¾ç½®å‚æ•°
- `bufferResults` - ç¼“å†²åŒºåˆ†æç»“æœ
- `currentResult` - å½“å‰ç»“æœ
- `isAnalyzing` - æ˜¯å¦æ­£åœ¨åˆ†æ

### **ä¾èµ–çš„Store**
- `useAnalysisStore` - åˆ†æçŠ¶æ€ç®¡ç†
- `useMapStore` - åœ°å›¾çŠ¶æ€ç®¡ç†



## ğŸ”— å åŠ åˆ†æåŠŸèƒ½ (useOverlayAnalysis)

### **åŠŸèƒ½æè¿°**
å‡ ä½•å åŠ åˆ†æã€æ“ä½œç±»å‹ç®¡ç†ã€ç»“æœå¤„ç†çš„ç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `executeOverlayAnalysis()` - æ‰§è¡Œå åŠ åˆ†æ
- `performGeometryOverlay()` - æ‰§è¡Œå‡ ä½•å åŠ 
- `saveOverlayResult()` - ä¿å­˜å åŠ ç»“æœ
- `clearOverlayResult()` - æ¸…ç†å åŠ ç»“æœ
- `exportOverlayResult()` - å¯¼å‡ºå åŠ ç»“æœ

### **å­˜å‚¨çš„çŠ¶æ€**
- `selectedLayer1` - é€‰ä¸­çš„ç¬¬ä¸€ä¸ªå›¾å±‚
- `selectedLayer2` - é€‰ä¸­çš„ç¬¬äºŒä¸ªå›¾å±‚
- `selectedOperation` - é€‰ä¸­çš„æ“ä½œç±»å‹
- `overlayResult` - å åŠ åˆ†æç»“æœ
- `isAnalyzing` - æ˜¯å¦æ­£åœ¨åˆ†æ

### **ä¾èµ–çš„Store**
- `useAnalysisStore` - åˆ†æçŠ¶æ€ç®¡ç†
- `useMapStore` - åœ°å›¾çŠ¶æ€ç®¡ç†

## ğŸ›£ï¸ æœ€çŸ­è·¯å¾„åˆ†æåŠŸèƒ½ (useShortestPathAnalysis)

### **åŠŸèƒ½æè¿°**
æœ€çŸ­è·¯å¾„åˆ†æã€éšœç¢ç‰©å¤„ç†ã€ç»“æœå¯è§†åŒ–çš„ç»„åˆå¼å‡½æ•°

### **è°ƒç”¨çš„å‡½æ•°**
- `displayAnalysisResults()` - æ˜¾ç¤ºåˆ†æç»“æœ
- `removePathLayersOnly()` - ä»…ç§»é™¤è·¯å¾„å›¾å±‚
- `removeAllAnalysisLayers()` - ç§»é™¤æ‰€æœ‰åˆ†æå›¾å±‚
- `executePathAnalysis()` - æ‰§è¡Œè·¯å¾„åˆ†æ
- `savePathResult()` - ä¿å­˜è·¯å¾„ç»“æœ
- `exportPathResults()` - å¯¼å‡ºè·¯å¾„ç»“æœ

### **å­˜å‚¨çš„çŠ¶æ€**
- `analysisResults` - åˆ†æç»“æœåˆ—è¡¨
- `layerName` - å›¾å±‚åç§°
- `isSelectingStartPoint` - æ˜¯å¦æ­£åœ¨é€‰æ‹©èµ·å§‹ç‚¹
- `isSelectingEndPoint` - æ˜¯å¦æ­£åœ¨é€‰æ‹©ç›®æ ‡ç‚¹
- `startPoint` - èµ·å§‹ç‚¹
- `endPoint` - ç›®æ ‡ç‚¹
- `analysisLayers` - åˆ†æå›¾å±‚å¼•ç”¨

### **ä¾èµ–çš„Store**
- `useMapStore` - åœ°å›¾çŠ¶æ€ç®¡ç†
- `useAnalysisStore` - åˆ†æçŠ¶æ€ç®¡ç†





## ğŸ”„ çŠ¶æ€ç®¡ç†æµç¨‹

### **åˆ†æå·¥å…·çŠ¶æ€ç®¡ç†**
```
ç”¨æˆ·æ“ä½œ â†’ ç»„åˆå¼å‡½æ•° â†’ StoreçŠ¶æ€æ›´æ–° â†’ ç»„ä»¶é‡æ–°æ¸²æŸ“ â†’ åœ°å›¾æ›´æ–°
```

### **æ•°æ®æµå‘**
```
APIè°ƒç”¨ â†’ æ•°æ®å¤„ç† â†’ Storeå­˜å‚¨ â†’ ç»„ä»¶è¯»å– â†’ ç•Œé¢å±•ç¤º
```

### **äº‹ä»¶ä¼ é€’é“¾**
```
åœ°å›¾äº¤äº’ â†’ ç»„åˆå¼å‡½æ•° â†’ Storeæ›´æ–° â†’ å…¶ä»–ç»„ä»¶å“åº” â†’ ç•Œé¢åŒæ­¥
```

## ğŸ“‹ åŠŸèƒ½ä¾èµ–å…³ç³»è¡¨

| åŠŸèƒ½æ¨¡å— | ä¸»è¦ç»„åˆå¼å‡½æ•° | ä¾èµ–Store | ä¸»è¦çŠ¶æ€ |
|---------|---------------|-----------|----------|
| åœ°å›¾æ ¸å¿ƒ | useMap | MapStore, SelectionStore, PopupStore, AnalysisStore, LoadingStore, ThemeStore | åœ°å›¾å®ä¾‹ã€å›¾å±‚ã€äº¤äº’çŠ¶æ€ |
| å›¾å±‚ç®¡ç† | useLayerManager | MapStore, SelectionStore, PopupStore, AnalysisStore | å›¾å±‚å¯è§æ€§ã€é€æ˜åº¦ã€é€‰æ‹©çŠ¶æ€ |
| è¦ç´ é€‰æ‹© | useFeatureSelection | MapStore, AnalysisStore, AreaSelectionStore, PopupStore | é€‰ä¸­è¦ç´ ã€é«˜äº®çŠ¶æ€ã€å‡ ä½•ä¿¡æ¯ |
| è¦ç´ æŸ¥è¯¢ | useFeatureQuery | FeatureQueryStore | æŸ¥è¯¢ç»“æœã€é€‰ä¸­è¦ç´ ã€é«˜äº®çŠ¶æ€ |
| ç¼“å†²åŒºåˆ†æ | useBufferAnalysis | AnalysisStore, MapStore | åˆ†æå‚æ•°ã€ç»“æœã€å›¾å±‚çŠ¶æ€ |

| å åŠ åˆ†æ | useOverlayAnalysis | AnalysisStore, MapStore | é€‰ä¸­å›¾å±‚ã€æ“ä½œç±»å‹ã€åˆ†æç»“æœ |
| æœ€çŸ­è·¯å¾„åˆ†æ | useShortestPathAnalysis | MapStore, AnalysisStore | è·¯å¾„ç»“æœã€åˆ†æå›¾å±‚ã€äº¤äº’çŠ¶æ€ |


## ğŸ¨ ä¸»é¢˜ç³»ç»Ÿé›†æˆ

### **CSSå˜é‡å¼•ç”¨**
- å›¾å±‚æ ·å¼ä½¿ç”¨ `--layer-stroke-${layerName}` å’Œ `--layer-fill-${layerName}`
- é€‰æ‹©é«˜äº®ä½¿ç”¨ `--map-select-fill` å’Œ `--map-highlight-color`
- ä¸»é¢˜è‰²ä½¿ç”¨ `--accent` ä½œä¸ºfallback

### **ä¸»é¢˜åˆ‡æ¢å“åº”**
- æ‰€æœ‰ç»„åˆå¼å‡½æ•°é€šè¿‡ `useThemeStore` å“åº”ä¸»é¢˜å˜åŒ–
- åœ°å›¾æ ·å¼è‡ªåŠ¨æ›´æ–°ä»¥åŒ¹é…å½“å‰ä¸»é¢˜
- åˆ†æç»“æœæ ·å¼è·Ÿéšä¸»é¢˜åˆ‡æ¢

## ğŸ”§ å·¥å…·çŠ¶æ€æŒä¹…åŒ–

### **çŠ¶æ€ä¿å­˜æœºåˆ¶**
- ä½¿ç”¨ `useModeStateStore` ä¿å­˜å·¥å…·çŠ¶æ€
- æ”¯æŒå‚æ•°ã€ç»“æœã€å›¾å±‚åç§°çš„æŒä¹…åŒ–
- å·¥å…·åˆ‡æ¢æ—¶è‡ªåŠ¨æ¢å¤ä¸Šæ¬¡çŠ¶æ€

### **çŠ¶æ€æ¸…ç†æœºåˆ¶**
- å·¥å…·åˆ‡æ¢æ—¶è‡ªåŠ¨æ¸…ç†åˆ†æç»“æœ
- ç§»é™¤ä¸´æ—¶åˆ†æå›¾å±‚
- é‡ç½®äº¤äº’çŠ¶æ€

