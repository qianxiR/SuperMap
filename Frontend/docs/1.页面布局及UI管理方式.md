# 页面布局及UI管理方式

## 🏗️ 整体布局架构设计

### **布局层级结构**
```
应用根布局 (App.vue)
    ↓
页面级布局 (Dashboard.vue)
    ↓
仪表板布局 (DashboardLayout.vue)
    ↓
分割面板布局 (splitpanes)
    ├── 左侧地图区域 (60%宽度)
    │   └── 地图容器 (SuperMapViewer)
    └── 右侧功能面板 (30%宽度)
        └── 功能面板容器 (RightPanel)
```

## 🔧 核心布局组件层级

### **第一层：应用根布局 (App.vue)**
- **位置**: `src/App.vue`
- **功能**: 全局样式、主题管理、通知管理器
- **包含组件**:
  - 全局样式 (`theme.css`)
  - 通知管理器 (`NotificationManager`)
  - 路由视图 (`router-view`)

### **第二层：页面级布局 (Dashboard.vue)**
- **位置**: `src/views/Dashboard.vue`
- **功能**: 页面入口，渲染仪表板布局
- **包含组件**:
  - `DashboardLayout.vue`

### **第三层：仪表板布局 (DashboardLayout.vue)**
- **位置**: `src/components/Layout/DashboardLayout.vue`
- **功能**: 主布局容器，管理头部和主内容区域
- **布局结构**:
  ```
  DashboardLayout
  ├── DashboardHeader (顶部导航栏)
  └── 主内容区域 (splitpanes)
      ├── 左侧地图区域 (60%)
      └── 右侧功能面板 (30%)
  ```
- **包含组件**:
  - `DashboardHeader.vue` → 顶部导航栏
  - `SuperMapViewer.vue` → 地图容器 (已移动到 `src/views/dashboard/`)
  - `RightPanel.vue` → 右侧功能面板容器 (已移动到 `src/views/dashboard/`)
  - `UserProfile.vue` → 个人中心模态框
  - `AIManagement.vue` → AI管理模态框

## 🗺️ 地图区域组件层级

### **第四层：地图容器 (SuperMapViewer.vue)**
- **位置**: `src/views/dashboard/SuperMapViewer.vue`
- **功能**: 地图显示核心容器
- **布局结构**:
  ```
  SuperMapViewer
  ├── 地图视图容器 (map-view)
  ├── LayerAssistant (左上角图层辅助)
  ├── FeaturePopup (要素弹窗)
  ├── CoordinateDisplay (左下角坐标显示)
  ├── ScaleBar (右下角比例尺)
  ├── OverviewMap (右下角鹰眼)
  ├── DistanceMeasurePanel (距离量算)
  └── AreaMeasurePanel (面积量算)
  ```
- **包含组件**:
  - `LayerAssistant.vue` → 图层辅助控件
  - `FeaturePopup.vue` → 要素弹窗
  - `CoordinateDisplay.vue` → 坐标显示
  - `ScaleBar.vue` → 比例尺
  - `OverviewMap.vue` → 鹰眼地图
  - `DistanceMeasurePanel.vue` → 距离量算面板
  - `AreaMeasurePanel.vue` → 面积量算面板

### **第五层：地图工具组件 (Map Tools)**
- **位置**: `src/components/Map/`
- **功能分类**:
  - **显示控件**: `CoordinateDisplay.vue`, `ScaleBar.vue`, `OverviewMap.vue`
  - **交互工具**: `FeaturePopup.vue`, `LayerAssistant.vue`
  - **测量工具**: `DistanceMeasurePanel.vue`, `AreaMeasurePanel.vue`

## 🎛️ 功能面板组件层级

### **第四层：右侧面板容器 (RightPanel.vue)**
- **位置**: `src/views/dashboard/RightPanel.vue`
- **功能**: 通过 `router-view` 渲染具体功能面板
- **特点**: 使用 `PanelWindow` 组件包装

### **第五层：功能面板包装器 (PanelWindow.vue)**
- **位置**: `src/components/UI/PanelWindow.vue`
- **功能**: 统一的面板窗口组件，提供标题栏、关闭按钮、拖拽等功能
- **特性**:
  - 可调整大小 (`resizable`)
  - 可拖拽定位 (`position`)
  - 动画效果 (`animated`)
  - 焦点管理 (`focusable`)
  - 嵌入模式 (`embed`)

### **第六层：具体功能面板组件**
- **LLM模式面板**:
  - `LLMMode.vue` → 主AI助手界面
  - `ChatHistory.vue` → 聊天历史记录
  - `ChatAssistant.vue` → AI对话工具

- **传统模式面板**:
  - `LayerManager.vue` → 图层管理
  - `FeatureQueryPanel.vue` → 要素查询
  - `EditTools.vue` → 图层编辑
  - `BufferAnalysisPanel.vue` → 缓冲区分析
  - `DistanceAnalysisPanel.vue` → 距离分析
  - `OverlayAnalysisPanel.vue` → 叠加分析

## 🎨 UI组件库层级

### **第七层：基础UI组件 (UI Components)**
- **位置**: `src/components/UI/`
- **功能分类**:

#### **按钮组件**
- `PrimaryButton.vue` → 主要按钮
- `SecondaryButton.vue` → 次要按钮
- `IconButton.vue` → 图标按钮
- `ButtonGroup.vue` → 按钮组

#### **输入组件**
- `TraditionalInputGroup.vue` → 传统输入组
- `LLMInputGroup.vue` → LLM输入组
- `QueryConditionRow.vue` → 查询条件行
- `DropdownSelect.vue` → 下拉选择器

#### **面板组件**
- `PanelContainer.vue` → 面板容器
- `PanelWindow.vue` → 面板窗口
- `SplitPanel.vue` → 分割面板

#### **对话框组件**
- `EditModal.vue` → 编辑模态框
- `ConfirmDialog.vue` → 确认对话框
- `TipWindow.vue` → 提示窗口

#### **通知组件**
- `NotificationToast.vue` → 通知提示
- `NotificationManager.vue` → 通知管理器

#### **容器组件**
- `AutoScrollContainer.vue` → 自动滚动容器

## 📱 响应式布局设计

### **分割面板布局 (splitpanes)**
- **主分割器**: 地图区域 (60%) + 功能面板 (30%)
- **最小尺寸限制**: 地图区域最小50%，功能面板最小30%
- **拖拽调整**: 用户可拖拽分割线调整面板大小
- **响应式**: 根据屏幕尺寸自动调整布局

### **移动端适配**
- **小屏幕**: 上下堆叠布局
- **触摸优化**: 触摸友好的拖拽操作
- **面板折叠**: 功能面板可折叠为图标

## 🎯 组件交互层级

### **状态管理层级**
```
组件状态 → 组件内状态 (ref/reactive)
    ↓
组合式函数 → useXXX composables
    ↓
Pinia Store → 全局状态管理
    ↓
路由状态 → Vue Router
```

### **事件传递层级**
```
子组件 → emit事件
    ↓
父组件 → 监听事件
    ↓
全局事件 → CustomEvent
    ↓
状态更新 → Store更新
```

## 🔄 动态渲染流程

### **功能面板渲染流程**
```
路由变化 → router-view更新
    ↓
RightPanel接收新路由
    ↓
PanelWindow包装功能组件
    ↓
具体功能面板渲染
    ↓
地图交互响应
```

### **地图组件更新流程**
```
地图状态变化 → MapStore更新
    ↓
地图实例更新 → OpenLayers更新
    ↓
地图控件更新 → 子组件更新
    ↓
用户界面响应 → 交互反馈
```

## 📋 组件依赖关系表

| 组件层级 | 组件名称 | 依赖组件 | 功能描述 |
|---------|---------|----------|----------|
| 第1层 | App.vue | - | 应用根组件 |
| 第2层 | Dashboard.vue | DashboardLayout | 页面入口 |
| 第3层 | DashboardLayout.vue | DashboardHeader, SuperMapViewer, RightPanel | 主布局容器 |
| 第4层 | SuperMapViewer.vue | LayerAssistant, FeaturePopup, CoordinateDisplay, ScaleBar, OverviewMap, DistanceMeasurePanel, AreaMeasurePanel | 地图容器 (已移动到views/dashboard) |
| 第4层 | RightPanel.vue | router-view | 功能面板容器 (已移动到views/dashboard) |
| 第5层 | PanelWindow.vue | - | 面板窗口包装器 |
| 第6层 | 功能面板组件 | PanelWindow | 具体功能实现 |
| 第7层 | UI组件 | - | 基础UI组件库 |

## 🎨 主题系统集成

### **CSS变量层级**
```
:root → 全局主题变量
    ↓
组件级变量 → 组件特定样式
    ↓
动态主题 → 明暗主题切换
    ↓
响应式主题 → 媒体查询适配
```

### **主题切换机制**
```
主题状态变化 → ThemeStore更新
    ↓
CSS变量更新 → document.documentElement
    ↓
组件样式响应 → CSS变量引用
    ↓
界面主题切换 → 视觉反馈
```

这种分层架构设计实现了：
1. **清晰的组件职责分离**
2. **可复用的UI组件库**
3. **响应式的布局系统**
4. **统一的状态管理**
5. **灵活的主题系统**
6. **良好的可维护性和可扩展性**
